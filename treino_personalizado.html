<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèãÔ∏è Anamnese + Treino COMPLETO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh; padding: 20px;
        }
        .container { 
            max-width: 1100px; margin: 0 auto; 
            background: white; border-radius: 25px; 
            box-shadow: 0 30px 60px rgba(0,0,0,0.2); overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; padding: 40px; text-align: center;
        }
        .header h1 { font-size: 2.8em; margin-bottom: 15px; }
        .form-container { padding: 40px; }
        .form-section { 
            margin-bottom: 35px; padding: 30px; 
            border: 2px solid #e1e8ed; border-radius: 20px; 
            background: #f8fafc;
        }
        .section-title { 
            font-size: 1.7em; color: #1a365d; 
            margin-bottom: 25px; padding-bottom: 15px; 
            border-bottom: 4px solid #4299e1; display: flex; align-items: center; gap: 15px;
        }
        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 10px; font-weight: 600; color: #2d3748; }
        input, select, textarea { 
            width: 100%; padding: 15px 18px; 
            border: 2px solid #e2e8f0; border-radius: 12px; 
            font-size: 16px; transition: all 0.3s ease;
        }
        input:focus, select:focus, textarea:focus { 
            outline: none; border-color: #4299e1; 
            box-shadow: 0 0 0 4px rgba(66, 153, 225, 0.1);
        }
        textarea { resize: vertical; min-height: 100px; }
        .checkbox-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 15px; margin-top: 10px;
        }
        .checkbox-item { display: flex; align-items: flex-start; gap: 12px; }
        input[type="checkbox"] { width: auto; transform: scale(1.3); margin-top: 2px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .medical-warning { 
            background: #fff5f5; border: 2px solid #fed7d7; border-radius: 12px; 
            padding: 20px; margin: 20px 0; color: #c53030; font-weight: 500;
        }
        .btn-primary { 
            background: linear-gradient(135deg, #48bb78, #38a169); 
            color: white; padding: 22px 60px; border: none; 
            border-radius: 15px; font-size: 1.4em; font-weight: 600; 
            cursor: pointer; width: 100%; transition: all 0.3s ease; margin-top: 30px;
        }
        .btn-primary:hover:not(:disabled) { 
            transform: translateY(-3px); box-shadow: 0 20px 40px rgba(72, 187, 120, 0.4); 
        }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-pdf { 
            background: linear-gradient(135deg, #f6ad55, #ed8936); 
            color: white; padding: 18px 30px; border: none; 
            border-radius: 15px; font-size: 1.2em; font-weight: 600; 
            cursor: pointer; transition: all 0.3s ease; 
            display: flex; align-items: center; gap: 12px; justify-content: center;
        }
        .btn-pdf:hover:not(:disabled) { 
            transform: translateY(-3px); box-shadow: 0 15px 35px rgba(246, 173, 85, 0.4); 
        }
        .btn-pdf:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-copy { 
            background: linear-gradient(135deg, #4299e1, #3182ce); 
            color: white; padding: 18px 30px; border: none; 
            border-radius: 15px; font-size: 1.2em; font-weight: 600; 
            cursor: pointer; transition: all 0.3s ease; 
            display: flex; align-items: center; gap: 12px; justify-content: center;
        }
        .btn-copy:hover { 
            transform: translateY(-3px); box-shadow: 0 15px 35px rgba(66, 153, 225, 0.4); 
        }
        .loading, .error, .success { display: none; padding: 30px; border-radius: 15px; margin-top: 25px; }
        .loading { background: #ebf8ff; border-left: 5px solid #4299e1; }
        .error { background: #fed7d7; border-left: 5px solid #e53e3e; }
        .success { background: #c6f6d5; border-left: 5px solid #38a169; }
        .treino-container { 
            background: #f8f9fa; border-radius: 15px; padding: 25px; 
            border-left: 5px solid #38a169; margin-top: 20px; white-space: pre-wrap; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.7; max-height: 700px; 
            overflow-y: auto; font-size: 15px;
        }
        .btn-group { 
            display: flex; gap: 15px; flex-wrap: wrap; margin-top: 25px; 
            justify-content: center;
        }
        @media (max-width: 768px) { 
            .form-row { grid-template-columns: 1fr; }
            .form-container { padding: 20px; }
            .header h1 { font-size: 2.2em; }
            .btn-group { flex-direction: column; }
            .btn-pdf, .btn-copy { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Anamnese + Treino Personalizado</h1>
            <p style="font-size: 1.2em; margin-top: 10px;">Preencha todos os campos para gerar seu treino 100% personalizado e seguro</p>
        </div>

        <div class="form-container">
            <form id="anamneseForm">
                <!-- 1. DADOS PESSOAIS -->
                <div class="form-section">
                    <h2 class="section-title">üë§ 1. Dados Pessoais</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nome Completo *</label>
                            <input type="text" id="nome" required>
                        </div>
                        <div class="form-group">
                            <label>Idade *</label>
                            <input type="number" id="idade" min="16" max="80" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Sexo *</label>
                            <select id="sexo" required>
                                <option value="">Selecione</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Feminino">Feminino</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Peso Atual (kg) *</label>
                            <input type="number" id="peso" step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label>Altura (cm) *</label>
                            <input type="number" id="altura" required>
                        </div>
                    </div>
                </div>

                <!-- 2. OBJETIVOS -->
                <div class="form-section">
                    <h2 class="section-title">üéØ 2. Objetivos & Experi√™ncia</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Objetivo Principal *</label>
                            <select id="objetivo" required>
                                <option value="">Selecione</option>
                                <option value="Emagrecimento">Emagrecimento</option>
                                <option value="Hipertrofia">Hipertrofia muscular</option>
                                <option value="Forca">Forca maxima</option>
                                <option value="Resistencia">Resistencia cardiovascular</option>
                                <option value="Saude">Saude geral</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Dias disponiveis/semana *</label>
                            <select id="diasSemana" required>
                                <option value="">Selecione</option>
                                <option value="2">2 dias</option>
                                <option value="3">3 dias</option>
                                <option value="4">4 dias</option>
                                <option value="5">5 dias</option>
                                <option value="6">6 dias</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Nivel de experiencia *</label>
                        <select id="experiencia" required>
                            <option value="">Selecione</option>
                            <option value="Iniciante">Iniciante (0-6 meses)</option>
                            <option value="Intermediario">Intermediario (6m-2 anos)</option>
                            <option value="Avancado">Avancado (+2 anos)</option>
                        </select>
                    </div>
                </div>

                <!-- 3. SA√öDE -->
                <div class="form-section">
                    <h2 class="section-title">üè• 3. Saude & Historico Medico</h2>
                    <div class="medical-warning">
                        <strong>‚ö†Ô∏è ATEN√á√ÉO M√âDICA:</strong> Marque TODAS as condi√ß√µes e descreva detalhes importantes
                    </div>

                    <div class="form-group">
                        <label>Condicoes Cronicas:</label>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="hipertensao"><label for="hipertensao">Hipertensao</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="hipotensao"><label for="hipotensao">Hipotensao</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="diabetes"><label for="diabetes">Diabetes</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="tireoide"><label for="tireoide">Tireoide</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="cardiaco"><label for="cardiaco">Cardiacas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="arritmia"><label for="arritmia">Arritmia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="colesterol"><label for="colesterol">Colesterol alto</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="renal"><label for="renal">Renais</label></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Respiratorio:</label>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="asma"><label for="asma">Asma</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="bronquite"><label for="bronquite">Bronquite</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="apneia"><label for="apneia">Apneia sono</label></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Ortopedico:</label>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="lombar"><label for="lombar">Dor lombar</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="joelho"><label for="joelho">Joelho</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ombro"><label for="ombro">Ombro</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="punho"><label for="punho">Punho/cotavelo</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="artrose"><label for="artrose">Artrose</label></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Medicamentos diarios:</label>
                            <textarea id="medicamentos" placeholder="Ex: Losartana 50mg, Metformina..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Cirurgias anteriores:</label>
                            <textarea id="cirurgias" placeholder="Ex: Hernia 2018, joelho 2022..."></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Lesoes atuais:</label>
                            <textarea id="lesoes" placeholder="Onde? Quando? Gravidade?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Alergias:</label>
                            <textarea id="alergias" placeholder="Medicamentos, suplementos, alimentos..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- 4. INFRAESTRUTURA -->
                <div class="form-section">
                    <h2 class="section-title">üèãÔ∏è 4. Infraestrutura & Preferencias</h2>
                    <div class="form-group">
                        <label>Onde treina? *</label>
                        <select id="local" required>
                            <option value="">Selecione</option>
                            <option value="Academia completa">Academia completa</option>
                            <option value="Academia casa">Academia em casa</option>
                            <option value="Ar livre">Ar livre</option>
                            <option value="Corpo livre">Apenas corpo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Observacoes importantes:</label>
                        <textarea id="observacoes" placeholder="Equipamentos disponiveis, horarios, exercicios que gosta/nao gosta..."></textarea>
                    </div>
                </div>

                <button type="submit" class="btn-primary" id="btnGerar">
                    üéØ Gerar Meu Treino Personalizado
                </button>
            </form>

            <!-- Loading -->
            <div class="loading" id="loading">
                <h2>ü§ñ Gerando seu treino personalizado...</h2>
                <div style="font-size: 5em; margin: 30px 0;">‚ö°</div>
                <p>Analisando dados medicos + criando treino seguro (5-15 segundos)</p>
            </div>

            <!-- Error -->
            <div class="error" id="error"></div>

            <!-- Success -->
            <div class="success" id="success" style="display: none;">
                <h2>‚úÖ <strong>Seu treino est√° pronto!</strong></h2>
                <div id="treinoContainer" class="treino-container"></div>
                
                <div class="btn-group">
                    <button onclick="gerarPDFTreino()" class="btn-pdf" id="btnPDF">
                        <span style="font-size: 1.4em;">üìÑ</span>
                        Baixar PDF Profissional
                    </button>
                    <button onclick="copiarTreino()" class="btn-copy">
                        <span style="font-size: 1.4em;">üìã</span>
                        Copiar WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ====================üî• CONFIGURE SUA CHAVE DEEPSEEK API ====================
        const DEEPSEEK_API_KEY = 'sk-f4e543d49b3e40c89bcdd6200f0cbada';
        // ============================================================================

        document.getElementById('anamneseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!DEEPSEEK_API_KEY || DEEPSEEK_API_KEY === 'SUA_CHAVE_DEEPSEEK_AQUI') {
                alert('‚ùå CONFIGURE SUA CHAVE API!\n\n1. Acesse: platform.deepseek.com ‚Üí API Keys\n2. Crie uma nova chave\n3. Cole na linha onde est√° DEEPSEEK_API_KEY');
                return;
            }

            const btn = document.getElementById('btnGerar');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const success = document.getElementById('success');
            
            loading.style.display = 'block';
            error.style.display = 'none';
            success.style.display = 'none';
            btn.disabled = true;
            btn.textContent = '‚è≥ Gerando...';

            try {
                const dados = coletarDadosFormulario();
                const treino = await chamarDeepSeekAPI(dados);
                
                document.getElementById('treinoContainer').textContent = treino;
                success.style.display = 'block';
                document.getElementById('btnPDF').disabled = false;
                
            } catch (err) {
                error.innerHTML = `
                    <h3>‚ùå Erro ao gerar treino</h3>
                    <p><strong>${err.message}</strong></p>
                    <p><em>‚Ä¢ Chave API inv√°lida ou sem saldo<br>‚Ä¢ Sem conex√£o com internet<br>‚Ä¢ Campos obrigat√≥rios n√£o preenchidos</em></p>
                `;
                error.style.display = 'block';
            } finally {
                loading.style.display = 'none';
                btn.disabled = false;
                btn.textContent = 'üéØ Gerar Meu Treino Personalizado';
            }
        });

        function coletarDadosFormulario() {
            const condicoes = [];
            const checkboxes = [
                'hipertensao', 'hipotensao', 'diabetes', 'tireoide', 'cardiaco', 'arritmia',
                'colesterol', 'renal', 'asma', 'bronquite', 'apneia', 'lombar', 'joelho',
                'ombro', 'punho', 'artrose'
            ];
            
            checkboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox && checkbox.checked) {
                    condicoes.push(checkbox.labels[0].textContent.trim());
                }
            });

            return {
                nome: document.getElementById('nome').value,
                idade: document.getElementById('idade').value,
                sexo: document.getElementById('sexo').value,
                peso: parseFloat(document.getElementById('peso').value),
                altura: parseFloat(document.getElementById('altura').value),
                objetivo: document.getElementById('objetivo').value,
                dias: document.getElementById('diasSemana').value,
                experiencia: document.getElementById('experiencia').value,
                medicamentos: document.getElementById('medicamentos').value || 'Nenhum',
                cirurgias: document.getElementById('cirurgias').value || 'Nenhuma',
                lesoes: document.getElementById('lesoes').value || 'Nenhuma',
                alergias: document.getElementById('alergias').value || 'Nenhuma',
                condicoes: condicoes.length ? condicoes.join(', ') : 'Nenhuma condicao',
                local: document.getElementById('local').value,
                observacoes: document.getElementById('observacoes').value || 'Nenhuma'
            };
        }

        async function chamarDeepSeekAPI(dados) {
            const imc = ((dados.peso / ((dados.altura/100) ** 2)).toFixed(1));
            
            const prompt = `Voce e um personal trainer MEDICO especialista com 20+ anos de experiencia. Crie um treino 100% SEGURO para:

NOME: ${dados.nome}, ${dados.idade} anos, ${dados.sexo}
MEDIDAS: ${dados.peso}kg, ${dados.altura}cm (IMC: ${imc})
OBJETIVO: ${dados.objetivo} | ${dados.dias} DIAS/SEMANA | ${dados.experiencia}
CONDICOES: ${dados.condicoes}
MEDICAMENTOS: ${dados.medicamentos}
CIRURGIAS: ${dados.cirurgias}
LESOES: ${dados.lesoes}
LOCAL: ${dados.local}
OBS: ${dados.observacoes}

FORMATO EXATO (APENAS TEXTO ASCII, SEM EMOJIS, SEM CARACTERES ESPECIAIS, PRONTO PARA PDF/WHATSAPP FORMATADO DE FORMA SIMPLES):

TITULO: Treino ${dados.objetivo} - ${dados.nome}

PRECAUCES MEDICAS:
‚Ä¢ Adaptacoes especificas para ${dados.condicoes}

DIA 1: FOCO PRINCIPAL
DURACAO: 45-60min
AQUECIMENTO: 5min exercicios seguros
TREINO PRINCIPAL:
1. Exercicio - 3x12-15 - 60s descanso

DIA 2: FOCO SECUNDARIO
...

PROGRESSAO SEMANAL:
‚Ä¢ Semana 1-2: foco tecnica
‚Ä¢ Semana 3-4: +carga 10%

ORIENTACOES FINAIS:
‚Ä¢ RPE 5-7/10
‚Ä¢ Respiracao continua
‚Ä¢ Progressao gradual`;

            const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${DEEPSEEK_API_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'deepseek-chat',
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: 4500,
                    temperature: 0.3
                })
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.error?.message || `Erro HTTP ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content.trim();
        }

        // PDF INFAL√çVEL - SEM html2canvas
        // üî• PDF COM T√ìPICOS ORGANIZADOS EM LINHAS - SUBSTITUA APENAS ESTA FUN√á√ÉO
        function gerarPDFTreino() {
            try {
                const { jsPDF } = window.jspdf;
                if (!jsPDF) {
                    alert('‚ùå Recarregue a pagina para carregar jsPDF');
                    return;
                }

                const doc = new jsPDF('p', 'mm', 'a4');
                let y = 20;

                // Limpeza DEFINITIVA de caracteres estranhos
                const treinoText = document.getElementById('treinoContainer').textContent;
                const textoLimpo = limparTextoParaPDF(treinoText);

                // CABE√áALHO PROFISSIONAL
                doc.setFontSize(22);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(30, 60, 130);
                doc.text('TREINO PERSONALIZADO', 105, y, { align: 'center' });
                y += 12;

                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(100, 100, 100);
                doc.text('TreinoF√°cil', 105, y, { align: 'center' });
                y += 8;
                doc.text(`Gerado: ${new Date().toLocaleDateString('pt-BR')} ${new Date().toLocaleTimeString('pt-BR')}`, 105, y, { align: 'center' });
                y += 20;

                // DADOS DO ALUNO - ORGANIZADO
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(0, 0, 0);
                doc.text('DADOS DO CLIENTE', 20, y);
                y += 15;

                doc.setFontSize(11);
                doc.setFont('helvetica', 'normal');
                doc.text(`Nome: ${document.getElementById('nome').value}`, 25, y); y += 7;
                doc.text(`Idade: ${document.getElementById('idade').value} anos`, 25, y); y += 7;
                doc.text(`Sexo: ${document.getElementById('sexo').value}`, 25, y); y += 7;
                doc.text(`Objetivo: ${document.getElementById('objetivo').value}`, 25, y); y += 7;
                doc.text(`Nivel: ${document.getElementById('experiencia').value}`, 25, y); y += 7;
                doc.text(`Frequencia: ${document.getElementById('diasSemana').value} dias/semana`, 25, y); y += 7;
                doc.text(`Local: ${document.getElementById('local').value}`, 25, y); 
                y += 15;

                // LINHA DIVISORIA
                doc.setLineWidth(0.5);
                doc.setDrawColor(200, 200, 200);
                doc.line(20, y, 190, y);
                y += 15;

                // üî• TREINO ORGANIZADO POR SE√á√ïES
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(0, 0, 0);
                doc.text('PROGRAMA DE TREINO', 20, y);
                y += 12;

                // DIVIDIR TREINO EM SE√á√ïES PRINCIPAIS
                const secoes = textoLimpo.split(/DIA \d+:/i).filter(s => s.trim());
                let linhaAtual = 0;

                for (let i = 0; i < secoes.length; i++) {
                    if (y > 260) {
                        doc.addPage();
                        y = 20;
                    }

                    // T√çTULOS DOS DIAS (DIA 1, DIA 2, etc)
                    if (i > 0) {
                        doc.setFontSize(13);
                        doc.setFont('helvetica', 'bold');
                        doc.setTextColor(66, 153, 225);
                        doc.text(`DIA ${i}:`, 20, y);
                        y += 10;
                    }

                    // CONTE√öDO DO DIA - PROCESSADO LINHA POR LINHA
                    const linhasDia = doc.splitTextToSize(secoes[i].trim(), 170);
                    
                    doc.setFontSize(11);
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor(0, 0, 0);

                    for (let j = 0; j < linhasDia.length; j++) {
                        if (y > 270) {
                            doc.addPage();
                            y = 20;
                        }
                        
                        // IDENTAR SUBITENS (AQUECIMENTO, TREINO PRINCIPAL, etc)
                        const linha = linhasDia[j].trim();
                        if (linha.match(/^(AQUECIMENTO|DURACAO|TREINO PRINCIPAL)/i)) {
                            doc.setFont('helvetica', 'bold');
                            doc.setTextColor(40, 90, 150);
                            doc.text(linha, 25, y); // IDENTADO
                        } else {
                            doc.setFont('helvetica', 'normal');
                            doc.setTextColor(0, 0, 0);
                            doc.text(linha, 20, y);
                        }
                        y += 6;
                    }

                    y += 5; // ESPA√áO entre dias
                }

                // SE√á√ïES FINAIS (PROGRESS√ÉO, ORIENTA√á√ïES)
                const secoesFinais = textoLimpo.match(/PROGRESSAO[^P]*$/i) || textoLimpo.match(/ORIENTACOES[^$]*$/i);
                if (secoesFinais && y < 250) {
                    y += 8;
                    doc.setFontSize(12);
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(0, 100, 0);
                    doc.text('ORIENTACOES FINAIS', 20, y);
                    y += 10;

                    const linhasFinais = doc.splitTextToSize(secoesFinais[0], 170);
                    doc.setFontSize(11);
                    doc.setFont('helvetica', 'normal');
                    
                    for (let k = 0; k < linhasFinais.length; k++) {
                        if (y > 270) {
                            doc.addPage();
                            y = 20;
                        }
                        doc.text(linhasFinais[k], 25, y);
                        y += 6;
                    }
                }

                // RODAP√â PROFISSIONAL
                doc.setFontSize(9);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(120, 120, 120);
                y = 285;
                doc.text('Este programa foi criado por IA especializada em fitness medico', 105, y, { align: 'center' });
                y += 5;
                doc.text('Consulte seu medico antes de iniciar qualquer programa de treino', 105, y, { align: 'center' });

                // SALVAR
                const nomeAluno = document.getElementById('nome').value
                    .replace(/[^a-zA-Z0-9\s]/g, '')
                    .substring(0, 20)
                    .trim() || 'Aluno';
                
                doc.save(`Treino_${nomeAluno}_${new Date().toISOString().slice(0,10)}.pdf`);
                
            } catch (error) {
                console.error('Erro PDF:', error);
                alert('‚ùå Erro ao gerar PDF. Verifique o console (F12) e tente novamente.');
            }
        }


        function limparTextoParaPDF(texto) {
            return texto
                .replace(/[^\x20-\x7E\n\r]/g, ' ') // Remove nao ASCII
                .replace(/\s+/g, ' ') // Normaliza espacos
                .replace(/ {2,}/g, ' ')
                .trim();
        }

        function copiarTreino() {
            const treinoLimpo = limparTextoParaPDF(document.getElementById('treinoContainer').textContent);
            
            navigator.clipboard.writeText(treinoLimpo).then(() => {
                alert('‚úÖ Treino copiado para WhatsApp/Email/Telegram!');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = treinoLimpo;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('‚úÖ Copiado! Cole no WhatsApp.');
            });
        }

        // Protecao basica
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', function(e) {
            if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && e.keyCode === 73)) {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
